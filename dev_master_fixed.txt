# 開発マスター

> このファイルは開発作業中に学んだナレッジ・フィードバックを蓄積していくファイルです。
> Cursorはこのファイルを参照して、より良い開発サポートを行います。

**最終更新:** 2026-02-21

---

## 使用技術

- **フロントエンド:** Next.js, Tailwind CSS, TypeScript
- **バックエンド:** Python, Streamlit
- **デスクトップ:** Electron, Vite
- **デプロイ:** Vercel, Netlify

---

## コーディングルール

### 全般
- **インフラ・構成の前提（毎回確認しない）:** Webシステムの開発・構築は基本的に「Vercelへのデプロイ」を前提に行う。そのため、システム構成やデータベースの選定において、Vercelと相性が悪いローカル専用DB（SQLiteなど）の提案は避け、最初からVercelで動作する構成（SupabaseやVercel Postgres等）を前提としてセットアップを進めること。
- **ターミナルコマンド実行前の説明義務（絶対厳守）:**
  ユーザーにターミナルコマンドの実行許可を求める際（システムが「Run command?」窓を出す際）は、**必ずその直前のメッセージで「いまから何のコマンドを実行しようとしているのか」「なぜそれが必要なのか」を、初心者にもわかるように日本語で簡潔に説明すること。**（エディタのUIボタンが英語であるため、ユーザーが不安にならないよう配慮する）
- **環境構築・デプロイ作業の自動化の徹底:**
  GitHubリポジトリの作成やVercelへのデプロイにおいて、ユーザーにブラウザでの手動操作（ポチポチ作業）を極力させないこと。初回構築時は、必ず事前に必要なCLIツール（`gh`や`vercel`など）のインストール・認証状態を確認し、足りなければインストールを提案した上で、コマンド一つでリポジトリ作成からPush、デプロイまで完結するフローをスクリプト等で自動化して提供すること。
- **スプレッドシート連携時のコピペ生成義務:**
  ユーザーにスプレッドシートの作成とヘッダー（見出し）行の入力を依頼する際は、ユーザーが一文字ずつ手打ちする手間を省くため、**必ずA1セルにコピペするだけで横一列に展開される形式（タブ区切りのコードブロックなど）**をセットで出力して提供すること。
- **デプロイやpush時の絶対厳守事項:** 
  Vercelなどへのデプロイやgit pushを行った際、絶対に「変更をプッシュしたので数分後に反映されます」とだけ伝えて終わりにしないこと。**必ずシステム側で再ビルドが成功・完了したこと（本番URLへの反映）を最後まで見届けて確認してから、ユーザーへ報告する**こと。
  （過去に何度も同じ指示・注意を受けたため、これは絶対厳守ルールのひとつです。確認を怠らず、反映されたことを実証してから回答してください。）
- **GAS（Google Apps Script）の更新デプロイ手順の絶対厳守事項:**
  GASのコードを変更した際、現在のシステムが読み込んでいるURLと同じURLを維持したまま（フロントエンドの環境変数を変えずに）裏側の処理だけを上書き更新するには、絶対に「新しいデプロイ」を選んではならない。「新しいデプロイ」を押すとURLが変わってしまいシステムが破壊される。
  **【正しいGAS上書き手順】: 「デプロイを管理」を選択 → 左側の現在アクティブなデプロイを選択して「鉛筆マーク（編集）」を押す → バージョンを「新バージョン」に変更して「デプロイ」を押す。** これをユーザーに説明時も間違えずに案内すること。
- **UI・デザイン配色の絶対ルール（白ベース徹底）:**
  `always-master.mdc`で定義されている「白系ベース。Apple UI を参考にしたシンプルさ」という全体ルールを**必ず・常に**意識すること。一部のカードや特定要素だけを目立たせるために、全体のトンマナを無視したダークカラー背景（例: Tailwindの `from-gray-900 to-gray-800` 等）を安易に使ってはいけない。目立たせたい場合は、ボーダー、微細な背景色（`bg-gray-50`など）、アイコン、シャドウなどを使い、**カード単位で白ベースの統一感を崩さない**手法を選ぶこと。

### Next.js
- （フィードバックを追記していく）

### Python / Streamlit
- （フィードバックを追記していく）

### TypeScript
- （フィードバックを追記していく）

---

## 開発ワークフローと原則 (Workflow & Principles)

**1. 計画と検証 (Plan First & Verify Before Done)**
- **計画からのスタート**: 3ステップ以上、あるいはアーキテクチャの意思決定を伴うタスクの開始時は、必ず「計画モード」に入り、事前に詳細な仕様を明確にする。
- **タスク管理**: 作業開始前に `tasks/todo.md` 等にチェック可能な計画を書き出し、ユーザーに確認する。実装中は進捗をチェックしながら、各ステップごとに概要を説明し、結果を文書化する。
- **即座の軌道修正**: 予期せぬ問題や想定外のエラーに直面した場合、強引に推し進めず、直ちに立ち止まって計画を練り直す。
- **完了前の検証義務**: テストの実行、ログの確認、正常動作の証明ができるまでタスクを完了としない。「シニアエンジニアが承認するか？」を常に自らに問うこと。

**2. 自律的な問題解決とバグ修正 (Autonomous Bug Fixing)**
- **手取り足取りを求めない**: バグ報告を受けた際は、ログやエラー、失敗しているテストを自ら特定して解決に向かう。ユーザーにコンテキストスイッチ（状況説明の手間など）を強要しない。
- **根本原因の解決 (No Laziness)**: 一時しのぎのハックな修正は避け、根本原因を見つけ出して修正する。

**3. 自己改善ループ (Self-Improvement Loop)**
- ユーザーから修正・指摘を受けた後は、直ちにそのパターンや対策を `tasks/lessons.md`（または開発マスターのフィードバック履歴）に記録する。
- 同じミスを未然に防ぐための独自ルールを定義し、ミス率の低下を徹底する。

**4. サブエージェントの活用 (Subagent Strategy)**
- メインの議論やコンテキストの肥大化を防ぐため、リサーチ・探索・並行分析は積極的にサブエージェント（別の思考プロセス・別スレッド等）にオフロードし、一点集中の実行を心がける。

**5. シンプルさとエレガンスの追求 (Demand Elegance & Simplicity)**
- 非自明で複雑な変更時には「もっと洗練された方法はないか？」と自問し、自らのコードを批判的にレビューする。
- 一方で、シンプルで自明な修正に対してはオーバーエンジニアリングをしない。
- 変更は必要最小限に留め、新たなバグを誘発しないこと (Minimal Impact)。

---

## よくあるエラーと解決策

### Next.js関連
| エラー | 原因 | 解決策 |
|-------|------|--------|
| （追記していく） | | |

### Vercelデプロイ関連
| エラー | 原因 | 解決策 |
|-------|------|--------|
| （追記していく） | | |

### Python関連
| エラー | 原因 | 解決策 |
|-------|------|--------|
| （追記していく） | | |

---

## UI/UXの好み・スタイル

- （フィードバックを追記していく）
- 例: 「ボタンは角丸で」「色は青系で統一」など

---

## コードスニペット

### よく使うパターン

```typescript
// ここによく使うコードを追記
```

---

## プロジェクト固有のメモ

### manga kiji lp
- （追記していく）

### Dashboard
- （追記していく）

### キッチンカーの窓口
- （追記していく）

---

## フィードバック履歴

### 2026-02-22
- ユーザーにスプレッドシートの作成などを依頼する際、ヘッダーを手打ちさせるのは手間になるため、**「A1セルに貼り付けるだけで全列に展開されるフォーマット（TSVなど）を必ず生成して添える」**というルールを全般セクションに追記しました。
- プロジェクト立ち上げ時（GitHub連携やVercel構築など）の手動操作をユーザーに頼ってしまったため、**「必要なCLIツール（ghなど）を駆使し、ブラウザでのポチポチ作業を排除して極力すべてコマンドで自動化する」**というルールを全般セクションに追記しました。
- コマンド実行のRun/Rejectボタンが英語のUIで分かりにくいという指摘を受けました。そのため、**「コマンドの実行許可を求める直前に、必ず何のコマンドで何をするのかを日本語で初心者向けに説明する」**というルールを開発マスターに追加しました。
- システム構築において「基本的にVercelへのデプロイが前提」であるというご指摘を頂きました。毎回のヒアリングを省くため、インフラやDBの選択肢（ローカル専用のSQLite等をわざわざ聞かない）はVercelと相性が良いものをデフォルトとするルールを全般セクションに追記しました。
- 単に「プッシュしました、数分後に見れます」と報告するのはNGという指摘を受けたため、**必ず再ビルド（Vercel）が成功したかをシステム側で確認し、反映を実証してから完了を伝える**というルールを開発マスター（全般セクション）に厳格に追記しました。
- GASの更新方法にて間違った案内（「新しいデプロイ」を選ぶ）をしてしまいシステムを一時的に破壊したため、**「同じURLでGASを更新する際は、必ず『デプロイを管理』からバージョンを『新バージョン』に上げて上書きする」**というルールを追加しました。
- ブラックリストのチェックタイミングは「通話後（業務報告時）」ではなく「通話前（相談受付時）」でなければ意味がないという鋭い指摘と気付きを得ました。システムの機能をどこに置くかは、フロントエンドの形式的な配置ではなく**「実際の業務フローのどのタイミングで、どう使われるのか」**に強い関心を持って設計・提案するようルール（教訓）として蓄積します。

### 2026-02-21
- デプロイ時の報告において、ビルド完了（エラーなし）まで見届けてからユーザーに伝える旨のルールをプルリクやpushの作法として追加

### 2026-02-16
- 開発マスター初版作成

<!-- 
使い方:
1. 開発中に「これ覚えておいて」「次からこうして」などのフィードバックがあれば
   該当セクションに追記していきます
2. エラーに遭遇して解決したら「よくあるエラーと解決策」に追記
3. コーディングの好みがあれば「コーディングルール」に追記
-->
-   �N�Vn0�0F0k0�[bHr�0�0�0�08NT0h0�c�OY0�0�0�0�0g0o00�0�0�0�0kk0w�O0h�:yY0�0h0U X �0
dm0�0_0�00�S��g0B0�0p0  \ G A S _ c o m p l e t e d _ c o d e . t x t \   I{n0�0F0k0�0�0�0�0�0�0�0�0h0W0f0�fM0�QW0f0�c�OY0�00�0W0O0o00�[bHr
0�0�Q�RY0�0��pe/ �0�0�0�0�0�0�c:yY0�00
 
 -   G A S �0�0�0n0�0F0j0��'Yj0�0�0�0�0�c:yY0�0��o00�0�0�0�0;ub��0�W�0=\O0U0j0D0�0F00�_Z0�0�0�0�0k0�[hQHrn0�0�0�0�0�0�0�0�0�0�Q�RW00]0n0�0�0�0�c:yW0f0B0R0�0S0h00R�_�k0�0�0�0�0W0�0Y0D0M�na�0Y0�00
 
 -   �0�0�0�0n0U R L �0;ub��ib�0�0�0�0�0k0Hh�QY0�0��o00��a�0�c,nk0<��0Z00�_Z0�0�0�0�0�0�0�0�0�N e x t . j s g0B0�0p0  \ s r c / a p p / p a g e . t s x \   j0i0n0�0�0�0�0�0�0�i �	��0  \  i e w _ f i l e \   �0  \ l i s t _ d i r \   g0�x��W0f0K0�0ck�xj0U R L �0OH0�0S0h00
 
 